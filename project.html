<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Project – Ryan Wong</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #f5f5f5;
      --surface: #ffffff;
      --text: #111827;
      --text-soft: #6b7280;
      --accent: #d90429;
      --border: #e5e7eb;
      --font-sans: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", sans-serif;
      --max-width: 800px;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      min-height: 100vh;
      background: var(--bg);
      color: var(--text);
      font-family: var(--font-sans);
      -webkit-font-smoothing: antialiased;
      padding: 24px 16px 48px;
    }

    .page {
      max-width: var(--max-width);
      margin: 0 auto;
    }

    header {
      margin-bottom: 18px;
    }

    .top-line {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 16px;
      font-size: 12px;
      color: var(--text-soft);
    }

    .top-left {
      display: flex;
      align-items: baseline;
      gap: 10px;
    }

    .wordmark {
      font-size: 14px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: var(--accent);
    }

    a.back-link {
      text-decoration: none;
      color: var(--text-soft);
      border-bottom: 1px solid transparent;
      padding-bottom: 1px;
      font-size: 12px;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      transition: border-color 120ms ease-out, color 120ms ease-out;
    }

    a.back-link:hover {
      color: #111827;
      border-bottom-color: #111827;
    }

    main {
      background: var(--surface);
      border-radius: 20px;
      border: 1px solid var(--border);
      padding: 20px 20px 18px;
    }

    .project-header {
      margin-bottom: 12px;
    }

    .project-title-row {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 4px;
    }

    .project-title {
      font-size: 22px;
      letter-spacing: -0.03em;
    }

    .project-stage {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: var(--text-soft);
      white-space: nowrap;
    }

    .project-summary {
      font-size: 14px;
      color: var(--text-soft);
      line-height: 1.6;
    }

    .project-meta {
      font-size: 11px;
      color: var(--text-soft);
      margin-top: 6px;
    }

    .project-meta span + span::before {
      content: "•";
      padding: 0 6px;
    }

    .section-heading {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--text-soft);
      margin-top: 16px;
      margin-bottom: 4px;
    }

    .project-detail {
      font-size: 13px;
      color: var(--text-soft);
      line-height: 1.6;
      white-space: pre-wrap;
    }

    .links-list {
      font-size: 13px;
      color: var(--text-soft);
      list-style: none;
      margin-top: 4px;
    }

    .links-list li + li {
      margin-top: 4px;
    }

    .links-list a {
      text-decoration: none;
      color: #111827;
      border-bottom: 1px solid transparent;
      padding-bottom: 1px;
      transition: border-color 120ms ease-out, color 120ms ease-out;
    }

    .links-list a:hover {
      border-bottom-color: #111827;
    }

    .status-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid var(--border);
      font-size: 10px;
      color: var(--text-soft);
      margin-top: 6px;
    }

    .status-pill span.dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--accent);
    }

    .not-found {
      font-size: 14px;
      color: var(--text-soft);
      text-align: center;
      padding: 40px 0;
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <div class="top-line">
        <div class="top-left">
          <div class="wordmark">Ryan Wong</div>
          <a href="index.html" class="back-link">← Project index</a>
        </div>
        <div id="project-status-label"></div>
      </div>
    </header>

    <main>
      <div id="project-container">
        <!-- Filled by JS -->
      </div>
    </main>
  </div>

  <script>
    function getSlugFromUrl() {
      const params = new URLSearchParams(window.location.search);
      return params.get('slug');
    }

    async function loadProjects() {
      try {
        const response = await fetch('projects.json', { cache: 'no-store' });
        if (!response.ok) {
          console.error('Failed to load projects.json:', response.status);
          showNotFound('Could not load project data.');
          return;
        }
        const data = await response.json();
        renderProjectFromData(data);
      } catch (err) {
        console.error('Error loading projects.json:', err);
        showNotFound('Could not load project data.');
      }
    }

    function showNotFound(message) {
      const container = document.getElementById('project-container');
      container.innerHTML = '';
      const div = document.createElement('div');
      div.className = 'not-found';
      div.textContent = message || 'Project not found.';
      container.appendChild(div);
    }

    function renderProjectFromData(data) {
      const slug = getSlugFromUrl();
      if (!slug) {
        showNotFound('No project specified.');
        return;
      }

      const projects = Array.isArray(data.projects) ? data.projects : [];
      const project = projects.find((p) => p.slug === slug);

      if (!project) {
        showNotFound('Project not found.');
        return;
      }

      const container = document.getElementById('project-container');
      container.innerHTML = '';

      const header = document.createElement('div');
      header.className = 'project-header';

      const titleRow = document.createElement('div');
      titleRow.className = 'project-title-row';

      const titleEl = document.createElement('h1');
      titleEl.className = 'project-title';
      titleEl.textContent = project.title || '';

      const stageEl = document.createElement('div');
      stageEl.className = 'project-stage';
      stageEl.textContent = project.stage || project.status || '';

      titleRow.appendChild(titleEl);
      titleRow.appendChild(stageEl);

      const summaryEl = document.createElement('p');
      summaryEl.className = 'project-summary';
      summaryEl.textContent = project.summary || '';

      header.appendChild(titleRow);
      header.appendChild(summaryEl);

      if (Array.isArray(project.meta) && project.meta.length > 0) {
        const metaEl = document.createElement('div');
        metaEl.className = 'project-meta';
        project.meta.forEach((m) => {
          const span = document.createElement('span');
          span.textContent = m;
          metaEl.appendChild(span);
        });
        header.appendChild(metaEl);
      }

      container.appendChild(header);

      const statusLabel = document.getElementById('project-status-label');
      if (statusLabel) {
        const pill = document.createElement('div');
        pill.className = 'status-pill';
        const dot = document.createElement('span');
        dot.className = 'dot';
        const text = document.createElement('span');
        text.textContent = (project.status || '').toUpperCase();
        pill.appendChild(dot);
        pill.appendChild(text);
        statusLabel.appendChild(pill);
      }

      if (project.detail) {
        const detailHeading = document.createElement('div');
        detailHeading.className = 'section-heading';
        detailHeading.textContent = 'Notes';
        container.appendChild(detailHeading);

        const detailEl = document.createElement('div');
        detailEl.className = 'project-detail';
        detailEl.textContent = project.detail;
        container.appendChild(detailEl);
      }

      if (Array.isArray(project.links) && project.links.length > 0) {
        const linksHeading = document.createElement('div');
        linksHeading.className = 'section-heading';
        linksHeading.textContent = 'Links';
        container.appendChild(linksHeading);

        const ul = document.createElement('ul');
        ul.className = 'links-list';

        project.links.forEach((link) => {
          if (!link.url) return;
          const li = document.createElement('li');
          const a = document.createElement('a');
          a.href = link.url;
          a.target = '_blank';
          a.rel = 'noopener';
          a.textContent = link.label || link.url;
          li.appendChild(a);
          ul.appendChild(li);
        });

        container.appendChild(ul);
      }
    }

    loadProjects();
  </script>
</body>
</html>
